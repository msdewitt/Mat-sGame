"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("../core");
const _1 = require("./");
class GenericContainer extends _1.Container {
    constructor(stereotype, type, dependencies, name) {
        super(stereotype, dependencies, name);
        this._type = type;
    }
    get type() {
        return this._type;
    }
    resolveDepedendencies() {
        function _resolveInstances(name) {
            let data = _1.ClassContainer.getDependency(name);
            return (data.stereotype == core_1.Stereotype.Singleton || data.stereotype == core_1.Stereotype.Easily)
                ? data.instance
                : data.resolveDepedendencies();
        }
        function _resolveHelper(dependencies, instance, resolved) {
            if (!dependencies || dependencies.length == 0)
                return instance;
            let _current = dependencies.pop();
            instance[_current.ref] = _resolveInstances(_current.container.name);
            _current.resolved = instance[_current.ref];
            resolved.push(_current);
            return _resolveHelper(dependencies, instance, resolved);
        }
        if (this.resolved.length != 0 && this._stereotype != core_1.Stereotype.Singleton) {
            let arr = this.resolved;
            this._instance = new class extends this.type {
                constructor(...args) {
                    super();
                    arr.forEach(x => {
                        this[x.ref] = x.resolved;
                    });
                }
            }();
        }
        else {
            this._instance = _resolveHelper(this.dependencies, new class extends this.type {
            }(), this._resolved);
            _1.ClassContainer.insertDependency(this.name, this);
        }
        return this._instance;
    }
}
exports.GenericContainer = GenericContainer;
//# sourceMappingURL=generic-container.js.map